## Tackling the Ill-Posedness of Super-Resolution through Adaptive Target Generation

[[Paper]](https://openaccess.thecvf.com/content/CVPR2021/html/Jo_Tackling_the_Ill-Posedness_of_Super-Resolution_Through_Adaptive_Target_Generation_CVPR_2021_paper.html)


## Dependency
- Python 3.6
- PyTorch 1.3


## First things to do
1. Clone this repo.
```
git clone https://github.com/yhjo09/AdaTarget
cd AdaTarget
```

2. Download pretrained [models](https://onedrive.live.com/?authkey=%21ANRk6%5FU4aYWdyTM&cid=ADFCB6E1F3CE1167&id=ADFCB6E1F3CE1167%2137325&parId=ADFCB6E1F3CE1167%2137317&o=OneUp) and extract it.
```
unzip models.zip
```


## Test - Isotropic Gaussian Kernels
1. Download a [zip](https://onedrive.live.com/?authkey=%21ANRk6%5FU4aYWdyTM&cid=ADFCB6E1F3CE1167&id=ADFCB6E1F3CE1167%2137323&parId=ADFCB6E1F3CE1167%2137317&o=OneUp) file containing the images of the Gaussian8 test set, and extract it.
```
unzip Gaussian8.zip
```
- The images were generated by following the instructions in the IKC [repository](https://github.com/yuanjunchai/IKC).

2. Run.
```
python test_Iso.py
```

3. Output images will be in `./output/Iso`.


## Test - Random Kernels
1. Download [DIV2KRK](http://www.wisdom.weizmann.ac.il/~vision/kernelgan/DIV2KRK_public.zip) test set (from [KernelGAN](https://github.com/sefibk/KernelGAN)) and unzip the zip file.
```
unzip DIV2KRK.zip
```

2. Run.
```
python test_RK.py
```

3. Output images will be in `./output/RK`.


## Test - Bicubic Downsampling
1. Download a [zip](https://onedrive.live.com/?authkey=%21ANRk6%5FU4aYWdyTM&cid=ADFCB6E1F3CE1167&id=ADFCB6E1F3CE1167%2137322&parId=ADFCB6E1F3CE1167%2137317&o=OneUp) file contains the images of the Set5, Set14, BSDS100, Urban100, and Manga109 test sets, and extract it.
```
unzip Bicubic.zip
```

2. Run.
```
python test_Bic.py
```

3. Output images will be in `./output/Bic`.


## Train - Pretraining ATG
Soon


## Train - Training SR Net with ATG
1. Prepare training images. 
- Download DIV2K [HR](http://data.vision.ee.ethz.ch/cvl/DIV2K/DIV2K_train_HR.zip) images (from [https://data.vision.ee.ethz.ch/cvl/DIV2K](https://data.vision.ee.ethz.ch/cvl/DIV2K/)) and unzip it to `./DIV2K/DIV2K_train_HR/*.png`.
- Download DIV2K [LR](https://onedrive.live.com/?authkey=%21ANRk6%5FU4aYWdyTM&cid=ADFCB6E1F3CE1167&id=ADFCB6E1F3CE1167%2137327&parId=ADFCB6E1F3CE1167%2137317&o=OneUp) images and unzip it to `./DIV2K/DIV2K_train_LR_RK/*.png`.
  - The LR images were generated by using [https://github.com/assafshocher/BlindSR_dataset_generator](https://github.com/assafshocher/BlindSR_dataset_generator) with random kernels.

2. Prepare validation images.
- Download DIV2K [HR](http://data.vision.ee.ethz.ch/cvl/DIV2K/DIV2K_valid_HR.zip) images and unzip it to `./DIV2K/DIV2K_valid_HR/*.png`.
- Download DIV2K [LR](https://onedrive.live.com/?authkey=%21ANRk6%5FU4aYWdyTM&cid=ADFCB6E1F3CE1167&id=ADFCB6E1F3CE1167%2137319&parId=ADFCB6E1F3CE1167%2137317&o=OneUp) images and unzip it to `./DIV2K/DIV2K_valid_LR_RK/*.png`.

3. Specify the pretrained parameters of the localization network to variable `PRETRAINED_LOCNET`.

4. Start training.
```
python train_RK.py
```
- Tensorboard log will be stored in `./pt_log`.
- Checkpoints and validation results will be saved in `./AdaTarget/`.




## BibTeX
```
@InProceedings{jo2021adatarget,
   author = {Jo, Younghyun and Oh, Seoung Wug and Vajda, Peter and Kim, Seon Joo},
   title = {Tackling the Ill-Posedness of Super-Resolution through Adaptive Target Generation},
   booktitle = {The IEEE/CVF Conference on Computer Vision and Pattern Recognition (CVPR)},
   month = {June},
   year = {2021}
}
```


## External codes from
- [LPIPS](https://github.com/richzhang/PerceptualSimilarity)
- [RRDB (ESRGAN)](https://github.com/xinntao/ESRGAN)
